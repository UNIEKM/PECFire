System.register(["jimu-core/react","jimu-core","jimu-arcgis","jimu-ui","esri/widgets/Search","esri/widgets/Search/LocatorSearchSource","esri/geometry/projection","esri/geometry/SpatialReference","esri/layers/GeoJSONLayer"],(function(e,t){var r={},o={},n={},i={},s={},a={},d={},c={},u={};return{setters:[function(e){r.useEffect=e.useEffect,r.useRef=e.useRef,r.useState=e.useState},function(e){o.css=e.css,o.jsx=e.jsx},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent},function(e){i.Alert=e.Alert,i.Card=e.Card,i.CardBody=e.CardBody},function(e){s.default=e.default},function(e){a.default=e.default},function(e){d.project=e.project},function(e){c.default=e.default},function(e){u.default=e.default}],execute:function(){e((()=>{var e={205:e=>{"use strict";e.exports=c},333:e=>{"use strict";e.exports=d},822:e=>{"use strict";e.exports=u},133:e=>{"use strict";e.exports=s},125:e=>{"use strict";e.exports=a},686:e=>{"use strict";e.exports=n},244:e=>{"use strict";e.exports=o},972:e=>{"use strict";e.exports=r},321:e=>{"use strict";e.exports=i}},t={};function l(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,l),n.exports}l.d=(e,t)=>{for(var r in t)l.o(t,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var f={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(f),l.d(f,{__set_webpack_public_path__:()=>w,default:()=>p});var e=l(972),t=l(244),r=l(686),o=l(321),n=l(133),i=l(125),s=l(333),a=l(205),d=l(822),c=function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function s(e){try{d(o.next(e))}catch(e){i(e)}}function a(e){try{d(o.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}d((o=o.apply(e,t||[])).next())}))};const u="w3w-grid-layer",g="YF3V15TI",p=l=>{var f;const p=(0,e.useRef)(null),w=(0,e.useRef)(null),m=(0,e.useRef)(null),x=(0,e.useRef)(null),[h,y]=(0,e.useState)(null),[j,b]=(0,e.useState)({words:"",lat:"",lng:""}),S=()=>{if(!p.current)return!1;const e=p.current.getBoundingClientRect();return e.width>0&&e.height>0},C=e=>{const t=e.map.findLayerById(u);t&&(e.map.remove(t),console.log("Grid layer removed."))};(0,e.useEffect)((()=>{if((null==h?void 0:h.view)&&w.current){const e=new i.default({url:"https://utility.arcgis.com/usrsvcs/servers/3fcc95bc42b2491f9998651fa0925162/rest/services/what3words_EN_English/GeocodeServer",name:"Custom Locator",singleLineFieldName:"SingleLine",placeholder:"Search 3 words (e.g., apple.banana.carrot)",suggestionsEnabled:!0,maxSuggestions:6,maxResults:6}),t=new n.default({view:h.view,container:w.current,includeDefaultSources:!1,sources:[e]});return t.on("select-result",(e=>{var t,r;const o=e.result;if("point"===(null===(r=null===(t=null==o?void 0:o.feature)||void 0===t?void 0:t.geometry)||void 0===r?void 0:r.type)){const e=o.feature.geometry,t=e.latitude.toFixed(6),r=e.longitude.toFixed(6);b({words:o.name,lat:t,lng:r}),h.view.goTo({target:e,zoom:18},{duration:1e3})}})),x.current=h.view.on("click",(e=>{var t;h.view,t=e.mapPoint,c(void 0,void 0,void 0,(function*(){const e=t,r=e.latitude.toFixed(6),o=e.longitude.toFixed(6);try{const e=yield fetch(`https://api.what3words.com/v3/convert-to-3wa?coordinates=${r},${o}&key=${g}`);if(!e.ok)return void console.error("API error fetching address.");const t=yield e.json();t.words?b({words:t.words,lat:r,lng:o}):b({words:"No address found",lat:r,lng:o})}catch(e){console.error("Error fetching address:",e)}}))})),m.current=h.view.watch("extent",(()=>{var e;S()&&h.view.zoom>17?(e=h.view,c(void 0,void 0,void 0,(function*(){if(!S())return console.log("Widget container not visible; aborting grid update."),void C(e);const t=e.extent;if(!t)return void console.error("No extent available.");const r=new a.default({wkid:4326}),o=4326===t.spatialReference.wkid?t:s.project(t,r);if(!o)return void console.error("Projection failed.");const n=`${o.ymin},${o.xmin}`,i=`${o.ymax},${o.xmax}`;if(Math.sqrt(Math.pow(o.xmax-o.xmin,2)+Math.pow(o.ymax-o.ymin,2))>4)return console.log("Zoom in further."),void C(e);try{const t=yield fetch(`https://api.what3words.com/v3/grid-section?bounding-box=${n},${i}&format=geojson&key=${g}`);if(!t.ok)return void console.error(`API error: ${t.status} ${t.statusText}`);if(!S())return console.log("Widget container became hidden; not adding grid."),void C(e);const r=yield t.json();C(e);const o=new d.default({url:URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),title:"What3Words Grid",id:u});e.map.add(o),console.log("Grid added.")}catch(e){console.error("Error fetching grid:",e)}}))):(console.log("Widget hidden or zoom too low; removing grid."),C(h.view))})),()=>{t&&t.destroy(),x.current&&(x.current.remove(),x.current=null),m.current&&(m.current.remove(),m.current=null),C(h.view),h.view.graphics&&h.view.graphics.removeAll()}}}),[h]);return(0,t.jsx)("div",{className:"widget-combined",ref:p,css:v},(0,t.jsx)(o.Card,{className:"widget-what3words"},(0,t.jsx)(o.CardBody,null,1===(null===(f=l.useMapWidgetIds)||void 0===f?void 0:f.length)&&(0,t.jsx)(r.JimuMapViewComponent,{useMapWidgetId:l.useMapWidgetIds[0],onActiveViewChange:e=>{e&&e.view&&y(e)}}),(0,t.jsx)("div",{ref:w,className:"search-container"}),(0,t.jsx)("div",{className:"address-info"},(0,t.jsx)("h3",null,"3-Word Address"),(0,t.jsx)("p",null,(0,t.jsx)("strong",null,"Address:")," ",j.words),(0,t.jsx)("p",null,(0,t.jsx)("strong",null,"Coordinates:")," ",j.lat,", ",j.lng)),(0,t.jsx)(o.Alert,{text:"The grid updates only when this widget is visible. Hide the widget to stop grid updates.",type:"info"}))))},v=t.css`
  padding: 10px;
  background: var(--light-100);

  .widget-what3words {
    text-align: center;
  }

  .search-container {
    width: 100%;
    height: 40px;
    margin-top: 10px;
  }

  .address-info {
    margin-top: 15px;
    font-size: 14px;
    color: var(--dark-600);
  }

  .address-info h3 {
    margin-bottom: 5px;
    font-size: 16px;
    color: var(--dark-800);
  }
`;function w(e){l.p=e}})(),f})())}}}));